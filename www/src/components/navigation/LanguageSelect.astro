---
import { KNOWN_LANGUAGES } from "../../config";
export interface Props {
  language: string;
}
const { language } = Astro.props;
---

<div class="flex items-center gap-2">
  <svg viewBox="0 0 88.6 77.3" class="h-6 w-6 text-t3-purple-100" role="img">
    <path
      fill="currentColor"
      d="M61 24.6h7.9l18.7 51.6h-7.7l-5.4-15.5H54.3l-5.6 15.5h-7.2L61 24.6zM72.6 55l-8-22.8L56.3 55h16.3z"
    ></path>
    <path
      fill="currentColor"
      d="M53.6 60.6c-10-4-16-9-22-14 0 0 1.3 1.3 0 0-6 5-20 13-20 13l-4-6c8-5 10-6 19-13-2.1-1.9-12-13-13-19h8c4 9 10 14 10 14 10-8 10-19 10-19h8s-1 13-12 24c5 5 10 9 19 13l-3 7zm-52-44h56v-8h-23v-7h-9v7h-24v8z"
    ></path>
  </svg>
  <label
    class="flex items-center h-10 bg-t3-purple-200/50 hover:bg-t3-purple-200/75 dark:bg-t3-purple-200/10 cursor-pointer border dark:border-t3-purple-200/20 dark:hover:border-t3-purple-200/50 p-2 w-fit rounded-lg"
  >
    <select
      id="language-select"
      class="appearance-none bg-transparent border-none"
      value={language}
      aria-label="Select language"
    >
      {
        Object.entries(KNOWN_LANGUAGES).map(([name, code]) => (
          <option
            value={code}
            class="cursor-pointer appearance-none outline-none"
          >
            {name} ({code})
          </option>
        ))
      }
    </select>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 320 512"
      class="h-4 text-t3-purple-100"
    >
      <path
        fill="currentColor"
        d="M137.4 374.6c12.5 12.5 32.8 12.5 45.3 0l128-128c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8L32 192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l128 128z"
      ></path>
    </svg>
  </label>
</div>

<script>
  const select = document.querySelector(
    "#language-select",
  ) as HTMLSelectElement;
  select?.addEventListener("change", (e) => {
    // @ts-ignore - Why is this not typed?
    const newLang = e.currentTarget.value;
    const [_1, _2, ...slug] = window.location.pathname.split("/");
    window.location.pathname = `/${newLang}/${slug.join("/")}`;
  });
</script>
